{"relation":[["","14","15","16","17","18","","","","19","","20","21","22","","23","24","25","26","","","27","28","","","","","","","","","","","","","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","","","","49","","50","51","52","53","","54","55","56","","","","","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246","247","248","249","250","251","252","253","254","255","256","257","258","259","260","261","262","263","264","265","266","267","268","269","270","271","272","273","274","275","276","277","278","279","280","281","282","283","284","285","286","287","288","289","290","291","292","293","294","295","296","297","298","299","300","301","302","303","304","305","306","307","308","309","310","311","312","313","314","315","316","317","318","319","320","321","322","323","324","325","326","327","328","329","330","331","332","333","334","335","336","337","338","339","340","341","342","343","344","345","346","347","348","349","350","351","352","353","354","355","356","357","358","359","360","361","362","363","364","365","366","367","368","369","370","371","372","373","374","375","376","377","378","379","380","381","382","383","384","385","386","387","388","389","390","391","392","393","394","395","396","397","398","399","400","401","402","403","404","405","406","407","408","409","410","411","412","413","414","415","416","417","418","419","420","421","422","423","424","425","426","427","428","429","430","431","432","433","434","435","436","437","438","439","440","441","442","443","444","445","446","447","448","449","450","451","452","453","454","455","456","457","458","459","460","461","462","463","464","465","466","467","468","469","470","471","472","473","474","475","476","477","478","479","480","481","482","483","484","485","486","487","488","489","490","491","492","493","494","495","496","497","498","499","500","501","502","503","504","505","506","507","508","509","510","511","512","513","514","515","516","517","518","519","520","521","522","523","524","525","526","527","528","529","530","531","532","533","534","535","536","537","538","539","540","541","542","543","544","545","546","547","548","549","550","551","552","553","554","555","556","557","558","559","560","561","562","563","564","565","566","567","568","569","570","571","572","573","574","575","576","577","578","579","580","581","582","583","584","585","586","587","588","589","590","591","592","593","594","595","596","597","598","599","600","601","602","603","604","605","606","607","608","609","610","611","612","613","614","615","616","617","618","619","620","621","622","623","624","625","626","627","628","629","630","631","632","633","634","635","636","637","638","639","640","641","642","643","644","645","646","647","648","649","650","651","652","653","654","655","656","657","658","659","660","661","662","663","664","665","666","667","668","669","670","671","672","673","674","675","676","677","678","679","680","681","682","683","684","685","686","687","688","689","690","691","692","693","694","695","696","697","698","699","700","701","702","703","704","705","706","707","708","709","710","711","712","713","714","715","716","717","718","719","720","721","722","723","724","725","726","727","728","729","730","731","732","733","734","735","736","737","738","739","740","741","742","743","744","745","746","747","748","749","750","751","752","753","754","755","756","757","758","759","760","761","762","763","764","765","766","767","768","769","770","771","772","773","774","775","776","777","778","779","780","781","782","783","784","785","786","787","788","789","790","791","792","793","794","795","796","797","798","799","800","801","802","803","804","805","806","807","808","809","810","811","812","813","814","815","816","817","818","819","820","821","822","823","824","825","826","827","828","829","830","831","832","833","834","835","836","837","838","839","840","841","842","843","844","845","846","847","848","849","850","851","852","853","854","855","856","857","858","859","860","861","862","863","864","865","866","867","868","869","870","871","872","873","874","875","876","877","878","879","880","881","882","883","884","885","886","887","888","889","890","891","892","893","894","895","896","897","898","899","900","901","902","903","904","905","906","907","908","909","910","911","912","913","914","915","916","917","918","919","920","921","922","923","924","925","926","927","928","929","930","931","932","933","934","935","936","937","938","939","940","941","942","943","944","945","946","947","948","949","950","951","952","953","954","955","956","957","958","959","960","961","962","963","964","965","966","967","968","969","970","971","972","973","974","975","976","977","978","979","980","981","982","983","984","985","986","987","988","989","990","991","992","993","994","995","996","997","998","999","1000","1001","1002","1003","1004","1005","1006","1007","1008","1009","1010","1011","1012","1013","1014","1015","1016","1017","1018","1019","1020","1021","1022","1023","1024","1025","1026","1027","1028","1029","1030","1031","1032","1033","1034","1035","1036","1037","1038","1039","1040","1041","1042","1043","1044","1045","1046","1047","1048","1049","1050","1051","1052","1053","1054","1055","1056","1057","1058","1059","1060","1061","1062","1063","1064","1065","1066","1067","1068","1069","1070","1071","1072","1073","1074","1075","1076","1077","1078","1079","1080","1081","1082","1083","1084","1085","1086","1087","1088","1089","1090","1091","1092","1093","1094","1095","1096","1097","1098","1099","1100","1101","1102","1103","1104","1105","1106","1107","1108","1109","1110","1111","1112","1113","1114","1115","1116","1117","1118","1119","1120","1121","1122","1123","1124","1125","1126","1127","1128","1129","1130","1131","1132","1133","1134","1135","1136","1137","1138","1139","1140","1141","1142","1143","1144","1145","1146","1147","1148","1149","1150","1151","1152","1153","1154","1155","1156","1157","1158","1159","1160","1161","1162","1163","1164","1165","1166","1167","1168","1169","1170","1171","1172","1173","1174","1175","1176","1177","1178","1179","1180","1181","1182","1183","1184","1185","1186","1187","1188","1189","1190","1191","1192","1193","1194","1195","1196","1197","1198","1199","1200","1201","1202","1203","1204","1205","1206","1207","1208","1209","1210","1211","1212","1213","1214","1215","1216","1217","1218","1219","1220","1221","1222","1223","1224","1225","1226","1227","1228","1229","1230","1231","1232","1233","1234","1235","1236","1237","1238","1239","1240","1241","1242","1243","1244","1245","1246","1247","1248","1249","1250","1251","1252","1253","1254","1255","1256","1257","1258","1259","1260","1261","1262","1263","1264","1265","1266","1267","1268","1269","1270","1271","1272","1273","1274","1275","1276","1277","1278","1279","1280","1281","1282","1283","1284","1285","1286","1287","1288","1289","1290","1291","1292","1293","1294","1295","1296","1297","1298","1299","1300","1301","1302","1303","1304","1305","1306","1307","1308","1309","1310","1311","1312","1313","1314","1315","1316","1317","1318","1319","1320","1321","1322","1323","1324","1325","1326","1327","1328","1329","1330","1331","1332","1333","1334","1335","1336","1337","1338","1339","1340","1341","1342","1343","1344","1345","1346","1347","1348","1349","1350","1351","1352","1353","1354","1355","1356","1357","1358","1359","1360","1361","1362","1363","1364","1365","1366","1367","1368","1369","1370","1371","1372","1373","1374","1375","1376","1377","1378","1379","1380","1381","1382","1383","1384","1385","1386","1387","1388","1389","1390","1391","1392","1393","1394","1395","1396","1397","1398","1399","1400","1401","1402","1403","1404","1405","1406","1407","1408","1409","1410","1411","1412","1413","1414","1415","1416","1417","1418","1419","1420","1421","1422","1423","1424","1425","1426","1427","1428","1429","1430","1431","1432","1433","1434","1435","1436","1437","1438","1439","1440","1441","1442","1443","1444","1445","1446","1447","1448","1449","1450","1451","1452","1453","1454","1455","1456","1457","1458","1459","1460","1461","1462","1463","1464","1465","1466","1467","1468","1469","1470","1471","1472","1473","1474","1475","1476","1477","1478","1479","1480","1481","1482","1483","1484","1485","1486","1487","1488","1489","1490","1491","1492","1493","1494","1495","1496","1497","1498","1499","1500","1501","1502","1503","1504","1505","1506","1507","1508","1509","1510","1511","1512","1513","1514","1515","1516","1517","1518","1519","1520","1521","1522","1523","1524","1525","1526","1527","1528","1529","1530","1531","1532","1533","1534","1535","1536","1537","1538","1539","1540","1541","1542","1543","1544","1545","1546","1547","1548","1549","1550","1551","1552","1553","1554","1555","1556","1557","1558","1559","1560","1561","1562","1563","1564","1565","1566","1567","1568","1569","1570","1571","1572","1573","1574","1575","1576","1577","1578","1579","1580","1581","1582","1583","1584","1585","1586","1587","1588","1589","","",""],["","14","15","16","","","17","18","19","20","21","22","","23","24","25","26","27","","28","29","30","","31","32","33","34","35","36","37","38","39","40","41","42","43","","","","","","","","","","","","","","","","","","","","44","45","46","47","48","49","","","","50","51","","","52","53","54","55","56","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","57","58","59"],["","define(\u0027DOING_AJAX\u0027, true);","define(\u0027WP_ADMIN\u0027, true);","","if ( ! isset( $_REQUEST[\u0027action\u0027] ) )","die(\u0027-1\u0027);","// Require an action parameter","if ( empty($_REQUEST[\u0027action\u0027]) )","die(\u0027-1\u0027);","","// Load libraries","require_once(\u0027../wp-load.php\u0027);","","require_once(\u0027./includes/admin.php\u0027);","require_once(\u0027./includes/ajax-actions.php\u0027);","@header(\u0027Content-Type: text/html; charset\u003d\u0027 . get_option(\u0027blog_charset\u0027));","send_nosniff_header();","","do_action(\u0027admin_init\u0027);","// Handle ajax actions","do_action( \u0027admin_init\u0027 );","","if ( ! is_user_logged_in() ) {","$core_actions \u003d array(","\u0027fetch-list\u0027, \u0027ajax-tag-search\u0027, \u0027compression-test\u0027, \u0027imgedit-preview\u0027,","\u0027menu-quick-search\u0027, \u0027oembed_cache\u0027, \u0027image-editor\u0027, \u0027delete-comment\u0027,","\u0027delete-tag\u0027, \u0027delete-link\u0027, \u0027delete-meta\u0027, \u0027delete-post\u0027, \u0027trash-post\u0027,","\u0027untrash-post\u0027, \u0027delete-page\u0027, \u0027dim-comment\u0027, \u0027add-link-category\u0027, \u0027add-tag\u0027,","\u0027get-tagcloud\u0027, \u0027get-comments\u0027, \u0027replyto-comment\u0027, \u0027edit-comment\u0027, \u0027add-menu-item\u0027,","\u0027add-meta\u0027, \u0027add-user\u0027, \u0027autosave\u0027, \u0027closed-postboxes\u0027, \u0027hidden-columns\u0027,","\u0027update-welcome-panel\u0027, \u0027menu-get-metabox\u0027, \u0027wp-link-ajax\u0027, \u0027menu-locations-save\u0027,","\u0027meta-box-order\u0027, \u0027get-permalink\u0027, \u0027sample-permalink\u0027, \u0027inline-save\u0027, \u0027inline-save-tax\u0027,","\u0027find_posts\u0027, \u0027widgets-order\u0027, \u0027save-widget\u0027, \u0027set-post-thumbnail\u0027, \u0027date_format\u0027,","\u0027time_format\u0027, \u0027wp-fullscreen-save-post\u0027, \u0027wp-remove-post-lock\u0027, \u0027dismiss-wp-pointer\u0027,",");","","if ( isset( $_POST[\u0027action\u0027] ) \u0026\u0026 $_POST[\u0027action\u0027] \u003d\u003d \u0027autosave\u0027 ) {","$id \u003d isset($_POST[\u0027post_ID\u0027])? (int) $_POST[\u0027post_ID\u0027] : 0;","","if ( ! $id )","die(\u0027-1\u0027);","","$message \u003d sprintf( __(\u0027 \u003cstrong\u003eALERT: You are logged out!\u003c/strong\u003e Could not save draft. Please log in again.\u0027), wp_login_url() );","$x \u003d new WP_Ajax_Response( array(","\u0027what\u0027 \u003d\u003e \u0027autosave\u0027,","\u0027id\u0027 \u003d\u003e $id,","\u0027data\u0027 \u003d\u003e $message",") );","$x-\u003esend();","}","","if ( !empty( $_REQUEST[\u0027action\u0027] ) )","do_action( \u0027wp_ajax_nopriv_\u0027 . $_REQUEST[\u0027action\u0027] );","","die(\u0027-1\u0027);","foreach ( $core_actions as $action ) {","$callback \u003d str_replace( \u0027-\u0027, \u0027_\u0027, $action );","add_action( \u0027wp_ajax_\u0027 . $action, \u0027wp_ajax_\u0027 . $callback, 1 );","}","unset( $core_actions, $action, $callback );","","if ( isset( $_GET[\u0027action\u0027] ) ) :","switch ( $action \u003d $_GET[\u0027action\u0027] ) :","case \u0027fetch-list\u0027 :","add_action( \u0027wp_ajax_nopriv_autosave\u0027, \u0027wp_ajax_nopriv_autosave\u0027, 1 );","","$list_class \u003d $_GET[\u0027list_args\u0027][\u0027class\u0027];","check_ajax_referer( \"fetch-list-$list_class\", \u0027_ajax_fetch_list_nonce\u0027 );","if ( is_user_logged_in() )","do_action( \u0027wp_ajax_\u0027 . $_REQUEST[\u0027action\u0027], $_REQUEST[\u0027action\u0027] ); // Authenticated actions","else","do_action( \u0027wp_ajax_nopriv_\u0027 . $_REQUEST[\u0027action\u0027], $_REQUEST[\u0027action\u0027] ); // Non-admin actions","","$current_screen \u003d convert_to_screen( $_GET[\u0027list_args\u0027][\u0027screen\u0027][\u0027id\u0027] );","","define( \u0027WP_NETWORK_ADMIN\u0027, $current_screen-\u003eis_network );","define( \u0027WP_USER_ADMIN\u0027, $current_screen-\u003eis_user );","","$wp_list_table \u003d _get_list_table( $list_class );","if ( ! $wp_list_table )","die( \u00270\u0027 );","","if ( ! $wp_list_table-\u003eajax_user_can() )","die( \u0027-1\u0027 );","","$wp_list_table-\u003eajax_response();","","die( \u00270\u0027 );","break;","case \u0027ajax-tag-search\u0027 :","if ( isset( $_GET[\u0027tax\u0027] ) ) {","$taxonomy \u003d sanitize_key( $_GET[\u0027tax\u0027] );","$tax \u003d get_taxonomy( $taxonomy );","if ( ! $tax )","die( \u00270\u0027 );","if ( ! current_user_can( $tax-\u003ecap-\u003eassign_terms ) )","die( \u0027-1\u0027 );","} else {","die(\u00270\u0027);","}","","$s \u003d stripslashes( $_GET[\u0027q\u0027] );","","if ( false !\u003d\u003d strpos( $s, \u0027,\u0027 ) ) {","$s \u003d explode( \u0027,\u0027, $s );","$s \u003d $s[count( $s ) - 1];","}","$s \u003d trim( $s );","if ( strlen( $s ) \u003c 2 )","die; // require 2 chars for matching","","$results \u003d $wpdb-\u003eget_col( $wpdb-\u003eprepare( \"SELECT t.name FROM $wpdb-\u003eterm_taxonomy AS tt INNER JOIN $wpdb-\u003eterms AS t ON tt.term_id \u003d t.term_id WHERE tt.taxonomy \u003d %s AND t.name LIKE (%s)\", $taxonomy, \u0027%\u0027 . like_escape( $s ) . \u0027%\u0027 ) );","","echo join( $results, \"\\n\" );","die;","break;","case \u0027wp-compression-test\u0027 :","if ( !current_user_can( \u0027manage_options\u0027 ) )","die(\u0027-1\u0027);","","if ( ini_get(\u0027zlib.output_compression\u0027) || \u0027ob_gzhandler\u0027 \u003d\u003d ini_get(\u0027output_handler\u0027) ) {","update_site_option(\u0027can_compress_scripts\u0027, 0);","die(\u00270\u0027);","}","","if ( isset($_GET[\u0027test\u0027]) ) {","header( \u0027Expires: Wed, 11 Jan 1984 05:00:00 GMT\u0027 );","header( \u0027Last-Modified: \u0027 . gmdate( \u0027D, d M Y H:i:s\u0027 ) . \u0027 GMT\u0027 );","header( \u0027Cache-Control: no-cache, must-revalidate, max-age\u003d0\u0027 );","header( \u0027Pragma: no-cache\u0027 );","header(\u0027Content-Type: application/x-javascript; charset\u003dUTF-8\u0027);","$force_gzip \u003d ( defined(\u0027ENFORCE_GZIP\u0027) \u0026\u0026 ENFORCE_GZIP );","$test_str \u003d \u0027\"wpCompressionTest Lorem ipsum dolor sit amet consectetuer mollis sapien urna ut a. Eu nonummy condimentum fringilla tempor pretium platea vel nibh netus Maecenas. Hac molestie amet justo quis pellentesque est ultrices interdum nibh Morbi. Cras mattis pretium Phasellus ante ipsum ipsum ut sociis Suspendisse Lorem. Ante et non molestie. Porta urna Vestibulum egestas id congue nibh eu risus gravida sit. Ac augue auctor Ut et non a elit massa id sodales. Elit eu Nulla at nibh adipiscing mattis lacus mauris at tempus. Netus nibh quis suscipit nec feugiat eget sed lorem et urna. Pellentesque lacus at ut massa consectetuer ligula ut auctor semper Pellentesque. Ut metus massa nibh quam Curabitur molestie nec mauris congue. Volutpat molestie elit justo facilisis neque ac risus Ut nascetur tristique. Vitae sit lorem tellus et quis Phasellus lacus tincidunt nunc Fusce. Pharetra wisi Suspendisse mus sagittis libero lacinia Integer consequat ac Phasellus. Et urna ac cursus tortor aliquam Aliquam amet tellus volutpat Vestibulum. Justo interdum condimentum In augue congue tellus sollicitudin Quisque quis nibh.\"\u0027;","","if ( 1 \u003d\u003d $_GET[\u0027test\u0027] ) {","echo $test_str;","die;","} elseif ( 2 \u003d\u003d $_GET[\u0027test\u0027] ) {","if ( !isset($_SERVER[\u0027HTTP_ACCEPT_ENCODING\u0027]) )","die(\u0027-1\u0027);","if ( false !\u003d\u003d stripos( $_SERVER[\u0027HTTP_ACCEPT_ENCODING\u0027], \u0027deflate\u0027) \u0026\u0026 function_exists(\u0027gzdeflate\u0027) \u0026\u0026 ! $force_gzip ) {","header(\u0027Content-Encoding: deflate\u0027);","$out \u003d gzdeflate( $test_str, 1 );","} elseif ( false !\u003d\u003d stripos( $_SERVER[\u0027HTTP_ACCEPT_ENCODING\u0027], \u0027gzip\u0027) \u0026\u0026 function_exists(\u0027gzencode\u0027) ) {","header(\u0027Content-Encoding: gzip\u0027);","$out \u003d gzencode( $test_str, 1 );","} else {","die(\u0027-1\u0027);","}","echo $out;","die;","} elseif ( \u0027no\u0027 \u003d\u003d $_GET[\u0027test\u0027] ) {","update_site_option(\u0027can_compress_scripts\u0027, 0);","} elseif ( \u0027yes\u0027 \u003d\u003d $_GET[\u0027test\u0027] ) {","update_site_option(\u0027can_compress_scripts\u0027, 1);","}","}","","die(\u00270\u0027);","break;","case \u0027imgedit-preview\u0027 :","$post_id \u003d intval($_GET[\u0027postid\u0027]);","if ( empty($post_id) || !current_user_can(\u0027edit_post\u0027, $post_id) )","die(\u0027-1\u0027);","","check_ajax_referer( \"image_editor-$post_id\" );","","include_once( ABSPATH . \u0027wp-admin/includes/image-edit.php\u0027 );","if ( ! stream_preview_image($post_id) )","die(\u0027-1\u0027);","","die();","break;","case \u0027menu-quick-search\u0027:","if ( ! current_user_can( \u0027edit_theme_options\u0027 ) )","die(\u0027-1\u0027);","","require_once ABSPATH . \u0027wp-admin/includes/nav-menu.php\u0027;","","_wp_ajax_menu_quick_search( $_REQUEST );","","exit;","break;","case \u0027oembed-cache\u0027 :","$return \u003d ( $wp_embed-\u003ecache_oembed( $_GET[\u0027post\u0027] ) ) ? \u00271\u0027 : \u00270\u0027;","die( $return );","break;","default :","do_action( \u0027wp_ajax_\u0027 . $_GET[\u0027action\u0027] );","die(\u00270\u0027);","break;","endswitch;","endif;","","/**","* Sends back current comment total and new page links if they need to be updated.","*","* Contrary to normal success AJAX response (\"1\"), die with time() on success.","*","* @since 2.7","*","* @param int $comment_id","* @return die","*/","function _wp_ajax_delete_comment_response( $comment_id, $delta \u003d -1 ) {","$total \u003d (int) @$_POST[\u0027_total\u0027];","$per_page \u003d (int) @$_POST[\u0027_per_page\u0027];","$page \u003d (int) @$_POST[\u0027_page\u0027];","$url \u003d esc_url_raw( @$_POST[\u0027_url\u0027] );","// JS didn\u0027t send us everything we need to know. Just die with success message","if ( !$total || !$per_page || !$page || !$url )","die( (string) time() );","","$total +\u003d $delta;","if ( $total \u003c 0 )","$total \u003d 0;","","// Only do the expensive stuff on a page-break, and about 1 other time per page","if ( 0 \u003d\u003d $total % $per_page || 1 \u003d\u003d mt_rand( 1, $per_page ) ) {","$post_id \u003d 0;","$status \u003d \u0027total_comments\u0027; // What type of comment count are we looking for?","$parsed \u003d parse_url( $url );","if ( isset( $parsed[\u0027query\u0027] ) ) {","parse_str( $parsed[\u0027query\u0027], $query_vars );","if ( !empty( $query_vars[\u0027comment_status\u0027] ) )","$status \u003d $query_vars[\u0027comment_status\u0027];","if ( !empty( $query_vars[\u0027p\u0027] ) )","$post_id \u003d (int) $query_vars[\u0027p\u0027];","}","","$comment_count \u003d wp_count_comments($post_id);","","if ( isset( $comment_count-\u003e$status ) ) // We\u0027re looking for a known type of comment count","$total \u003d $comment_count-\u003e$status;","// else use the decremented value from above","}","","$time \u003d time(); // The time since the last comment count","","$x \u003d new WP_Ajax_Response( array(","\u0027what\u0027 \u003d\u003e \u0027comment\u0027,","\u0027id\u0027 \u003d\u003e $comment_id, // here for completeness - not used","\u0027supplemental\u0027 \u003d\u003e array(","\u0027total_items_i18n\u0027 \u003d\u003e sprintf( _n( \u00271 item\u0027, \u0027%s items\u0027, $total ), number_format_i18n( $total ) ),","\u0027total_pages\u0027 \u003d\u003e ceil( $total / $per_page ),","\u0027total_pages_i18n\u0027 \u003d\u003e number_format_i18n( ceil( $total / $per_page ) ),","\u0027total\u0027 \u003d\u003e $total,","\u0027time\u0027 \u003d\u003e $time",")",") );","$x-\u003esend();","}","","function _wp_ajax_add_hierarchical_term() {","$action \u003d $_POST[\u0027action\u0027];","$taxonomy \u003d get_taxonomy(substr($action, 4));","check_ajax_referer( $action, \u0027_ajax_nonce-add-\u0027 . $taxonomy-\u003ename );","if ( !current_user_can( $taxonomy-\u003ecap-\u003eedit_terms ) )","die(\u0027-1\u0027);","$names \u003d explode(\u0027,\u0027, $_POST[\u0027new\u0027.$taxonomy-\u003ename]);","$parent \u003d isset($_POST[\u0027new\u0027.$taxonomy-\u003ename.\u0027_parent\u0027]) ? (int) $_POST[\u0027new\u0027.$taxonomy-\u003ename.\u0027_parent\u0027] : 0;","if ( 0 \u003e $parent )","$parent \u003d 0;","if ( $taxonomy-\u003ename \u003d\u003d \u0027category\u0027 )","$post_category \u003d isset($_POST[\u0027post_category\u0027]) ? (array) $_POST[\u0027post_category\u0027] : array();","else","$post_category \u003d ( isset($_POST[\u0027tax_input\u0027]) \u0026\u0026 isset($_POST[\u0027tax_input\u0027][$taxonomy-\u003ename]) ) ? (array) $_POST[\u0027tax_input\u0027][$taxonomy-\u003ename] : array();","$checked_categories \u003d array_map( \u0027absint\u0027, (array) $post_category );","$popular_ids \u003d wp_popular_terms_checklist($taxonomy-\u003ename, 0, 10, false);","","foreach ( $names as $cat_name ) {","$cat_name \u003d trim($cat_name);","$category_nicename \u003d sanitize_title($cat_name);","if ( \u0027\u0027 \u003d\u003d\u003d $category_nicename )","continue;","if ( !($cat_id \u003d term_exists($cat_name, $taxonomy-\u003ename, $parent)) ) {","$new_term \u003d wp_insert_term($cat_name, $taxonomy-\u003ename, array(\u0027parent\u0027 \u003d\u003e $parent));","$cat_id \u003d $new_term[\u0027term_id\u0027];","}","$checked_categories[] \u003d $cat_id;","if ( $parent ) // Do these all at once in a second","continue;","$category \u003d get_term( $cat_id, $taxonomy-\u003ename );","ob_start();","wp_terms_checklist( 0, array( \u0027taxonomy\u0027 \u003d\u003e $taxonomy-\u003ename, \u0027descendants_and_self\u0027 \u003d\u003e $cat_id, \u0027selected_cats\u0027 \u003d\u003e $checked_categories, \u0027popular_cats\u0027 \u003d\u003e $popular_ids ));","$data \u003d ob_get_contents();","ob_end_clean();","$add \u003d array(","\u0027what\u0027 \u003d\u003e $taxonomy-\u003ename,","\u0027id\u0027 \u003d\u003e $cat_id,","\u0027data\u0027 \u003d\u003e str_replace( array(\"\\n\", \"\\t\"), \u0027\u0027, $data),","\u0027position\u0027 \u003d\u003e -1",");","}","","if ( $parent ) { // Foncy - replace the parent and all its children","$parent \u003d get_term( $parent, $taxonomy-\u003ename );","$term_id \u003d $parent-\u003eterm_id;","","while ( $parent-\u003eparent ) { // get the top parent","$parent \u003d \u0026get_term( $parent-\u003eparent, $taxonomy-\u003ename );","if ( is_wp_error( $parent ) )","break;","$term_id \u003d $parent-\u003eterm_id;","}","","ob_start();","wp_terms_checklist( 0, array(\u0027taxonomy\u0027 \u003d\u003e $taxonomy-\u003ename, \u0027descendants_and_self\u0027 \u003d\u003e $term_id, \u0027selected_cats\u0027 \u003d\u003e $checked_categories, \u0027popular_cats\u0027 \u003d\u003e $popular_ids));","$data \u003d ob_get_contents();","ob_end_clean();","$add \u003d array(","\u0027what\u0027 \u003d\u003e $taxonomy-\u003ename,","\u0027id\u0027 \u003d\u003e $term_id,","\u0027data\u0027 \u003d\u003e str_replace( array(\"\\n\", \"\\t\"), \u0027\u0027, $data),","\u0027position\u0027 \u003d\u003e -1",");","}","","ob_start();","wp_dropdown_categories( array(","\u0027taxonomy\u0027 \u003d\u003e $taxonomy-\u003ename, \u0027hide_empty\u0027 \u003d\u003e 0, \u0027name\u0027 \u003d\u003e \u0027new\u0027.$taxonomy-\u003ename.\u0027_parent\u0027, \u0027orderby\u0027 \u003d\u003e \u0027name\u0027,","\u0027hierarchical\u0027 \u003d\u003e 1, \u0027show_option_none\u0027 \u003d\u003e \u0027— \u0027.$taxonomy-\u003elabels-\u003eparent_item.\u0027 —\u0027",") );","$sup \u003d ob_get_contents();","ob_end_clean();","$add[\u0027supplemental\u0027] \u003d array( \u0027newcat_parent\u0027 \u003d\u003e $sup );","","$x \u003d new WP_Ajax_Response( $add );","$x-\u003esend();","}","","$id \u003d isset($_POST[\u0027id\u0027])? (int) $_POST[\u0027id\u0027] : 0;","switch ( $action \u003d $_POST[\u0027action\u0027] ) :","case \u0027delete-comment\u0027 : // On success, die with time() instead of 1","if ( !$comment \u003d get_comment( $id ) )","die( (string) time() );","if ( ! current_user_can( \u0027edit_comment\u0027, $comment-\u003ecomment_ID ) )","die(\u0027-1\u0027);","","check_ajax_referer( \"delete-comment_$id\" );","$status \u003d wp_get_comment_status( $comment-\u003ecomment_ID );","","$delta \u003d -1;","if ( isset($_POST[\u0027trash\u0027]) \u0026\u0026 1 \u003d\u003d $_POST[\u0027trash\u0027] ) {","if ( \u0027trash\u0027 \u003d\u003d $status )","die( (string) time() );","$r \u003d wp_trash_comment( $comment-\u003ecomment_ID );","} elseif ( isset($_POST[\u0027untrash\u0027]) \u0026\u0026 1 \u003d\u003d $_POST[\u0027untrash\u0027] ) {","if ( \u0027trash\u0027 !\u003d $status )","die( (string) time() );","$r \u003d wp_untrash_comment( $comment-\u003ecomment_ID );","if ( ! isset( $_POST[\u0027comment_status\u0027] ) || $_POST[\u0027comment_status\u0027] !\u003d \u0027trash\u0027 ) // undo trash, not in trash","$delta \u003d 1;","} elseif ( isset($_POST[\u0027spam\u0027]) \u0026\u0026 1 \u003d\u003d $_POST[\u0027spam\u0027] ) {","if ( \u0027spam\u0027 \u003d\u003d $status )","die( (string) time() );","$r \u003d wp_spam_comment( $comment-\u003ecomment_ID );","} elseif ( isset($_POST[\u0027unspam\u0027]) \u0026\u0026 1 \u003d\u003d $_POST[\u0027unspam\u0027] ) {","if ( \u0027spam\u0027 !\u003d $status )","die( (string) time() );","$r \u003d wp_unspam_comment( $comment-\u003ecomment_ID );","if ( ! isset( $_POST[\u0027comment_status\u0027] ) || $_POST[\u0027comment_status\u0027] !\u003d \u0027spam\u0027 ) // undo spam, not in spam","$delta \u003d 1;","} elseif ( isset($_POST[\u0027delete\u0027]) \u0026\u0026 1 \u003d\u003d $_POST[\u0027delete\u0027] ) {","$r \u003d wp_delete_comment( $comment-\u003ecomment_ID );","} else {","die(\u0027-1\u0027);","}","","if ( $r ) // Decide if we need to send back \u00271\u0027 or a more complicated response including page links and comment counts","_wp_ajax_delete_comment_response( $comment-\u003ecomment_ID, $delta );","die( \u00270\u0027 );","break;","case \u0027delete-tag\u0027 :","$tag_id \u003d (int) $_POST[\u0027tag_ID\u0027];","check_ajax_referer( \"delete-tag_$tag_id\" );","","$taxonomy \u003d !empty($_POST[\u0027taxonomy\u0027]) ? $_POST[\u0027taxonomy\u0027] : \u0027post_tag\u0027;","$tax \u003d get_taxonomy($taxonomy);","","if ( !current_user_can( $tax-\u003ecap-\u003edelete_terms ) )","die(\u0027-1\u0027);","","$tag \u003d get_term( $tag_id, $taxonomy );","if ( !$tag || is_wp_error( $tag ) )","die(\u00271\u0027);","","if ( wp_delete_term($tag_id, $taxonomy))","die(\u00271\u0027);","else","die(\u00270\u0027);","break;","case \u0027delete-link\u0027 :","check_ajax_referer( \"delete-bookmark_$id\" );","if ( !current_user_can( \u0027manage_links\u0027 ) )","die(\u0027-1\u0027);","","$link \u003d get_bookmark( $id );","if ( !$link || is_wp_error( $link ) )","die(\u00271\u0027);","","if ( wp_delete_link( $id ) )","die(\u00271\u0027);","else","die(\u00270\u0027);","break;","case \u0027delete-meta\u0027 :","check_ajax_referer( \"delete-meta_$id\" );","if ( !$meta \u003d get_metadata_by_mid( \u0027post\u0027, $id ) )","die(\u00271\u0027);","","if ( is_protected_meta( $meta-\u003emeta_key, \u0027post\u0027 ) || ! current_user_can( \u0027delete_post_meta\u0027, $meta-\u003epost_id, $meta-\u003emeta_key ) )","die(\u0027-1\u0027);","if ( delete_meta( $meta-\u003emeta_id ) )","die(\u00271\u0027);","die(\u00270\u0027);","break;","case \u0027delete-post\u0027 :","check_ajax_referer( \"{$action}_$id\" );","if ( !current_user_can( \u0027delete_post\u0027, $id ) )","die(\u0027-1\u0027);","","if ( !get_post( $id ) )","die(\u00271\u0027);","","if ( wp_delete_post( $id ) )","die(\u00271\u0027);","else","die(\u00270\u0027);","break;","case \u0027trash-post\u0027 :","case \u0027untrash-post\u0027 :","check_ajax_referer( \"{$action}_$id\" );","if ( !current_user_can( \u0027delete_post\u0027, $id ) )","die(\u0027-1\u0027);","","if ( !get_post( $id ) )","die(\u00271\u0027);","","if ( \u0027trash-post\u0027 \u003d\u003d $action )","$done \u003d wp_trash_post( $id );","else","$done \u003d wp_untrash_post( $id );","","if ( $done )","die(\u00271\u0027);","","die(\u00270\u0027);","break;","case \u0027delete-page\u0027 :","check_ajax_referer( \"{$action}_$id\" );","if ( !current_user_can( \u0027delete_page\u0027, $id ) )","die(\u0027-1\u0027);","","if ( !get_page( $id ) )","die(\u00271\u0027);","","if ( wp_delete_post( $id ) )","die(\u00271\u0027);","else","die(\u00270\u0027);","break;","case \u0027dim-comment\u0027 : // On success, die with time() instead of 1","","if ( !$comment \u003d get_comment( $id ) ) {","$x \u003d new WP_Ajax_Response( array(","\u0027what\u0027 \u003d\u003e \u0027comment\u0027,","\u0027id\u0027 \u003d\u003e new WP_Error(\u0027invalid_comment\u0027, sprintf(__(\u0027Comment %d does not exist\u0027), $id))",") );","$x-\u003esend();","}","","if ( ! current_user_can( \u0027edit_comment\u0027, $comment-\u003ecomment_ID ) \u0026\u0026 ! current_user_can( \u0027moderate_comments\u0027 ) )","die(\u0027-1\u0027);","","$current \u003d wp_get_comment_status( $comment-\u003ecomment_ID );","if ( $_POST[\u0027new\u0027] \u003d\u003d $current )","die( (string) time() );","","check_ajax_referer( \"approve-comment_$id\" );","if ( in_array( $current, array( \u0027unapproved\u0027, \u0027spam\u0027 ) ) )","$result \u003d wp_set_comment_status( $comment-\u003ecomment_ID, \u0027approve\u0027, true );","else","$result \u003d wp_set_comment_status( $comment-\u003ecomment_ID, \u0027hold\u0027, true );","","if ( is_wp_error($result) ) {","$x \u003d new WP_Ajax_Response( array(","\u0027what\u0027 \u003d\u003e \u0027comment\u0027,","\u0027id\u0027 \u003d\u003e $result",") );","$x-\u003esend();","}","","// Decide if we need to send back \u00271\u0027 or a more complicated response including page links and comment counts","_wp_ajax_delete_comment_response( $comment-\u003ecomment_ID );","die( \u00270\u0027 );","break;","case \u0027add-link-category\u0027 : // On the Fly","check_ajax_referer( $action );","if ( !current_user_can( \u0027manage_categories\u0027 ) )","die(\u0027-1\u0027);","$names \u003d explode(\u0027,\u0027, $_POST[\u0027newcat\u0027]);","$x \u003d new WP_Ajax_Response();","foreach ( $names as $cat_name ) {","$cat_name \u003d trim($cat_name);","$slug \u003d sanitize_title($cat_name);","if ( \u0027\u0027 \u003d\u003d\u003d $slug )","continue;","if ( !$cat_id \u003d term_exists( $cat_name, \u0027link_category\u0027 ) ) {","$cat_id \u003d wp_insert_term( $cat_name, \u0027link_category\u0027 );","}","$cat_id \u003d $cat_id[\u0027term_id\u0027];","$cat_name \u003d esc_html(stripslashes($cat_name));","$x-\u003eadd( array(","\u0027what\u0027 \u003d\u003e \u0027link-category\u0027,","\u0027id\u0027 \u003d\u003e $cat_id,","\u0027data\u0027 \u003d\u003e \" $cat_name\",","\u0027position\u0027 \u003d\u003e -1",") );","}","$x-\u003esend();","break;","case \u0027add-tag\u0027 :","check_ajax_referer( \u0027add-tag\u0027, \u0027_wpnonce_add-tag\u0027 );","$post_type \u003d !empty($_POST[\u0027post_type\u0027]) ? $_POST[\u0027post_type\u0027] : \u0027post\u0027;","$taxonomy \u003d !empty($_POST[\u0027taxonomy\u0027]) ? $_POST[\u0027taxonomy\u0027] : \u0027post_tag\u0027;","$tax \u003d get_taxonomy($taxonomy);","","if ( !current_user_can( $tax-\u003ecap-\u003eedit_terms ) )","die(\u0027-1\u0027);","","$x \u003d new WP_Ajax_Response();","","$tag \u003d wp_insert_term($_POST[\u0027tag-name\u0027], $taxonomy, $_POST );","","if ( !$tag || is_wp_error($tag) || (!$tag \u003d get_term( $tag[\u0027term_id\u0027], $taxonomy )) ) {","$message \u003d __(\u0027An error has occurred. Please reload the page and try again.\u0027);","if ( is_wp_error($tag) \u0026\u0026 $tag-\u003eget_error_message() )","$message \u003d $tag-\u003eget_error_message();","","$x-\u003eadd( array(","\u0027what\u0027 \u003d\u003e \u0027taxonomy\u0027,","\u0027data\u0027 \u003d\u003e new WP_Error(\u0027error\u0027, $message )",") );","$x-\u003esend();","}","","set_current_screen( $_POST[\u0027screen\u0027] );","","$wp_list_table \u003d _get_list_table(\u0027WP_Terms_List_Table\u0027);","","$level \u003d 0;","if ( is_taxonomy_hierarchical($taxonomy) ) {","$level \u003d count( get_ancestors( $tag-\u003eterm_id, $taxonomy ) );","ob_start();","$wp_list_table-\u003esingle_row( $tag, $level );","$noparents \u003d ob_get_clean();","}","","ob_start();","$wp_list_table-\u003esingle_row( $tag );","$parents \u003d ob_get_clean();","","$x-\u003eadd( array(","\u0027what\u0027 \u003d\u003e \u0027taxonomy\u0027,","\u0027supplemental\u0027 \u003d\u003e compact(\u0027parents\u0027, \u0027noparents\u0027)",") );","$x-\u003eadd( array(","\u0027what\u0027 \u003d\u003e \u0027term\u0027,","\u0027position\u0027 \u003d\u003e $level,","\u0027supplemental\u0027 \u003d\u003e (array) $tag",") );","$x-\u003esend();","break;","case \u0027get-tagcloud\u0027 :","if ( isset( $_POST[\u0027tax\u0027] ) ) {","$taxonomy \u003d sanitize_key( $_POST[\u0027tax\u0027] );","$tax \u003d get_taxonomy( $taxonomy );","if ( ! $tax )","die( \u00270\u0027 );","if ( ! current_user_can( $tax-\u003ecap-\u003eassign_terms ) )","die( \u0027-1\u0027 );","} else {","die(\u00270\u0027);","}","","$tags \u003d get_terms( $taxonomy, array( \u0027number\u0027 \u003d\u003e 45, \u0027orderby\u0027 \u003d\u003e \u0027count\u0027, \u0027order\u0027 \u003d\u003e \u0027DESC\u0027 ) );","","if ( empty( $tags ) )","die( isset( $tax-\u003eno_tagcloud ) ? $tax-\u003eno_tagcloud : __(\u0027No tags found!\u0027) );","","if ( is_wp_error( $tags ) )","die( $tags-\u003eget_error_message() );","","foreach ( $tags as $key \u003d\u003e $tag ) {","$tags[ $key ]-\u003elink \u003d \u0027#\u0027;","$tags[ $key ]-\u003eid \u003d $tag-\u003eterm_id;","}","","// We need raw tag names here, so don\u0027t filter the output","$return \u003d wp_generate_tag_cloud( $tags, array(\u0027filter\u0027 \u003d\u003e 0) );","","if ( empty($return) )","die(\u00270\u0027);","","echo $return;","","exit;","break;","case \u0027get-comments\u0027 :","check_ajax_referer( $action );","","set_current_screen( \u0027edit-comments\u0027 );","","$wp_list_table \u003d _get_list_table(\u0027WP_Post_Comments_List_Table\u0027);","","if ( !current_user_can( \u0027edit_post\u0027, $post_id ) )","die(\u0027-1\u0027);","","$wp_list_table-\u003eprepare_items();","","if ( !$wp_list_table-\u003ehas_items() )","die(\u00271\u0027);","","$x \u003d new WP_Ajax_Response();","ob_start();","foreach ( $wp_list_table-\u003eitems as $comment ) {","if ( ! current_user_can( \u0027edit_comment\u0027, $comment-\u003ecomment_ID ) )","continue;","get_comment( $comment );","$wp_list_table-\u003esingle_row( $comment );","}","$comment_list_item \u003d ob_get_contents();","ob_end_clean();","","$x-\u003eadd( array(","\u0027what\u0027 \u003d\u003e \u0027comments\u0027,","\u0027data\u0027 \u003d\u003e $comment_list_item",") );","$x-\u003esend();","break;","case \u0027replyto-comment\u0027 :","check_ajax_referer( $action, \u0027_ajax_nonce-replyto-comment\u0027 );","","set_current_screen( \u0027edit-comments\u0027 );","","$comment_post_ID \u003d (int) $_POST[\u0027comment_post_ID\u0027];","if ( !current_user_can( \u0027edit_post\u0027, $comment_post_ID ) )","die(\u0027-1\u0027);","","$status \u003d $wpdb-\u003eget_var( $wpdb-\u003eprepare(\"SELECT post_status FROM $wpdb-\u003eposts WHERE ID \u003d %d\", $comment_post_ID) );","","if ( empty($status) )","die(\u00271\u0027);","elseif ( in_array($status, array(\u0027draft\u0027, \u0027pending\u0027, \u0027trash\u0027) ) )","die( __(\u0027ERROR: you are replying to a comment on a draft post.\u0027) );","","$user \u003d wp_get_current_user();","if ( $user-\u003eID ) {","$comment_author \u003d $wpdb-\u003eescape($user-\u003edisplay_name);","$comment_author_email \u003d $wpdb-\u003eescape($user-\u003euser_email);","$comment_author_url \u003d $wpdb-\u003eescape($user-\u003euser_url);","$comment_content \u003d trim($_POST[\u0027content\u0027]);","if ( current_user_can( \u0027unfiltered_html\u0027 ) ) {","if ( wp_create_nonce( \u0027unfiltered-html-comment\u0027 ) !\u003d $_POST[\u0027_wp_unfiltered_html_comment\u0027] ) {","kses_remove_filters(); // start with a clean slate","kses_init_filters(); // set up the filters","}","}","} else {","die( __(\u0027Sorry, you must be logged in to reply to a comment.\u0027) );","}","","if ( \u0027\u0027 \u003d\u003d $comment_content )","die( __(\u0027ERROR: please type a comment.\u0027) );","","$comment_parent \u003d absint($_POST[\u0027comment_ID\u0027]);","$comment_auto_approved \u003d false;","$commentdata \u003d compact(\u0027comment_post_ID\u0027, \u0027comment_author\u0027, \u0027comment_author_email\u0027, \u0027comment_author_url\u0027, \u0027comment_content\u0027, \u0027comment_type\u0027, \u0027comment_parent\u0027, \u0027user_ID\u0027);","","$comment_id \u003d wp_new_comment( $commentdata );","$comment \u003d get_comment($comment_id);","if ( ! $comment ) die(\u00271\u0027);","","$position \u003d ( isset($_POST[\u0027position\u0027]) \u0026\u0026 (int) $_POST[\u0027position\u0027] ) ? (int) $_POST[\u0027position\u0027] : \u0027-1\u0027;","","// automatically approve parent comment","if ( !empty($_POST[\u0027approve_parent\u0027]) ) {","$parent \u003d get_comment( $comment_parent );","","if ( $parent \u0026\u0026 $parent-\u003ecomment_approved \u003d\u003d\u003d \u00270\u0027 \u0026\u0026 $parent-\u003ecomment_post_ID \u003d\u003d $comment_post_ID ) {","if ( wp_set_comment_status( $parent-\u003ecomment_ID, \u0027approve\u0027 ) )","$comment_auto_approved \u003d true;","}","}","","ob_start();","if ( \u0027dashboard\u0027 \u003d\u003d $_REQUEST[\u0027mode\u0027] ) {","require_once( ABSPATH . \u0027wp-admin/includes/dashboard.php\u0027 );","_wp_dashboard_recent_comments_row( $comment );","} else {","if ( \u0027single\u0027 \u003d\u003d $_REQUEST[\u0027mode\u0027] ) {","$wp_list_table \u003d _get_list_table(\u0027WP_Post_Comments_List_Table\u0027);","} else {","$wp_list_table \u003d _get_list_table(\u0027WP_Comments_List_Table\u0027);","}","$wp_list_table-\u003esingle_row( $comment );","}","$comment_list_item \u003d ob_get_contents();","ob_end_clean();","","$response \u003d array(","\u0027what\u0027 \u003d\u003e \u0027comment\u0027,","\u0027id\u0027 \u003d\u003e $comment-\u003ecomment_ID,","\u0027data\u0027 \u003d\u003e $comment_list_item,","\u0027position\u0027 \u003d\u003e $position",");","","if ( $comment_auto_approved )","$response[\u0027supplemental\u0027] \u003d array( \u0027parent_approved\u0027 \u003d\u003e $parent-\u003ecomment_ID );","","$x \u003d new WP_Ajax_Response();","$x-\u003eadd( $response );","$x-\u003esend();","break;","case \u0027edit-comment\u0027 :","check_ajax_referer( \u0027replyto-comment\u0027, \u0027_ajax_nonce-replyto-comment\u0027 );","","set_current_screen( \u0027edit-comments\u0027 );","","$comment_id \u003d (int) $_POST[\u0027comment_ID\u0027];","if ( ! current_user_can( \u0027edit_comment\u0027, $comment_id ) )","die(\u0027-1\u0027);","","if ( \u0027\u0027 \u003d\u003d $_POST[\u0027content\u0027] )","die( __(\u0027ERROR: please type a comment.\u0027) );","","$_POST[\u0027comment_status\u0027] \u003d $_POST[\u0027status\u0027];","edit_comment();","","$position \u003d ( isset($_POST[\u0027position\u0027]) \u0026\u0026 (int) $_POST[\u0027position\u0027]) ? (int) $_POST[\u0027position\u0027] : \u0027-1\u0027;","$comments_status \u003d isset($_POST[\u0027comments_listing\u0027]) ? $_POST[\u0027comments_listing\u0027] : \u0027\u0027;","","$checkbox \u003d ( isset($_POST[\u0027checkbox\u0027]) \u0026\u0026 true \u003d\u003d $_POST[\u0027checkbox\u0027] ) ? 1 : 0;","$wp_list_table \u003d _get_list_table( $checkbox ? \u0027WP_Comments_List_Table\u0027 : \u0027WP_Post_Comments_List_Table\u0027 );","","ob_start();","$wp_list_table-\u003esingle_row( get_comment( $comment_id ) );","$comment_list_item \u003d ob_get_contents();","ob_end_clean();","","$x \u003d new WP_Ajax_Response();","","$x-\u003eadd( array(","\u0027what\u0027 \u003d\u003e \u0027edit_comment\u0027,","\u0027id\u0027 \u003d\u003e $comment-\u003ecomment_ID,","\u0027data\u0027 \u003d\u003e $comment_list_item,","\u0027position\u0027 \u003d\u003e $position","));","","$x-\u003esend();","break;","case \u0027add-menu-item\u0027 :","if ( ! current_user_can( \u0027edit_theme_options\u0027 ) )","die(\u0027-1\u0027);","","check_ajax_referer( \u0027add-menu_item\u0027, \u0027menu-settings-column-nonce\u0027 );","","require_once ABSPATH . \u0027wp-admin/includes/nav-menu.php\u0027;","","// For performance reasons, we omit some object properties from the checklist.","// The following is a hacky way to restore them when adding non-custom items.","","$menu_items_data \u003d array();","foreach ( (array) $_POST[\u0027menu-item\u0027] as $menu_item_data ) {","if (","! empty( $menu_item_data[\u0027menu-item-type\u0027] ) \u0026\u0026","\u0027custom\u0027 !\u003d $menu_item_data[\u0027menu-item-type\u0027] \u0026\u0026","! empty( $menu_item_data[\u0027menu-item-object-id\u0027] )",") {","switch( $menu_item_data[\u0027menu-item-type\u0027] ) {","case \u0027post_type\u0027 :","$_object \u003d get_post( $menu_item_data[\u0027menu-item-object-id\u0027] );","break;","","case \u0027taxonomy\u0027 :","$_object \u003d get_term( $menu_item_data[\u0027menu-item-object-id\u0027], $menu_item_data[\u0027menu-item-object\u0027] );","break;","}","","$_menu_items \u003d array_map( \u0027wp_setup_nav_menu_item\u0027, array( $_object ) );","$_menu_item \u003d array_shift( $_menu_items );","","// Restore the missing menu item properties","$menu_item_data[\u0027menu-item-description\u0027] \u003d $_menu_item-\u003edescription;","}","","$menu_items_data[] \u003d $menu_item_data;","}","","$item_ids \u003d wp_save_nav_menu_items( 0, $menu_items_data );","if ( is_wp_error( $item_ids ) )","die(\u0027-1\u0027);","","foreach ( (array) $item_ids as $menu_item_id ) {","$menu_obj \u003d get_post( $menu_item_id );","if ( ! empty( $menu_obj-\u003eID ) ) {","$menu_obj \u003d wp_setup_nav_menu_item( $menu_obj );","$menu_obj-\u003elabel \u003d $menu_obj-\u003etitle; // don\u0027t show \"(pending)\" in ajax-added items","$menu_items[] \u003d $menu_obj;","}","}","","if ( ! empty( $menu_items ) ) {","$args \u003d array(","\u0027after\u0027 \u003d\u003e \u0027\u0027,","\u0027before\u0027 \u003d\u003e \u0027\u0027,","\u0027link_after\u0027 \u003d\u003e \u0027\u0027,","\u0027link_before\u0027 \u003d\u003e \u0027\u0027,","\u0027walker\u0027 \u003d\u003e new Walker_Nav_Menu_Edit,",");","echo walk_nav_menu_tree( $menu_items, 0, (object) $args );","}","break;","case \u0027add-meta\u0027 :","check_ajax_referer( \u0027add-meta\u0027, \u0027_ajax_nonce-add-meta\u0027 );","$c \u003d 0;","$pid \u003d (int) $_POST[\u0027post_id\u0027];","$post \u003d get_post( $pid );","","if ( isset($_POST[\u0027metakeyselect\u0027]) || isset($_POST[\u0027metakeyinput\u0027]) ) {","if ( !current_user_can( \u0027edit_post\u0027, $pid ) )","die(\u0027-1\u0027);","if ( isset($_POST[\u0027metakeyselect\u0027]) \u0026\u0026 \u0027#NONE#\u0027 \u003d\u003d $_POST[\u0027metakeyselect\u0027] \u0026\u0026 empty($_POST[\u0027metakeyinput\u0027]) )","die(\u00271\u0027);","if ( $post-\u003epost_status \u003d\u003d \u0027auto-draft\u0027 ) {","$save_POST \u003d $_POST; // Backup $_POST","$_POST \u003d array(); // Make it empty for edit_post()","$_POST[\u0027action\u0027] \u003d \u0027draft\u0027; // Warning fix","$_POST[\u0027post_ID\u0027] \u003d $pid;","$_POST[\u0027post_type\u0027] \u003d $post-\u003epost_type;","$_POST[\u0027post_status\u0027] \u003d \u0027draft\u0027;","$now \u003d current_time(\u0027timestamp\u0027, 1);","$_POST[\u0027post_title\u0027] \u003d sprintf(\u0027Draft created on %s at %s\u0027, date(get_option(\u0027date_format\u0027), $now), date(get_option(\u0027time_format\u0027), $now));","","if ( $pid \u003d edit_post() ) {","if ( is_wp_error( $pid ) ) {","$x \u003d new WP_Ajax_Response( array(","\u0027what\u0027 \u003d\u003e \u0027meta\u0027,","\u0027data\u0027 \u003d\u003e $pid",") );","$x-\u003esend();","}","$_POST \u003d $save_POST; // Now we can restore original $_POST again","if ( !$mid \u003d add_meta( $pid ) )","die(__(\u0027Please provide a custom field value.\u0027));","} else {","die(\u00270\u0027);","}","} else if ( !$mid \u003d add_meta( $pid ) ) {","die(__(\u0027Please provide a custom field value.\u0027));","}","","$meta \u003d get_metadata_by_mid( \u0027post\u0027, $mid );","$pid \u003d (int) $meta-\u003epost_id;","$meta \u003d get_object_vars( $meta );","$x \u003d new WP_Ajax_Response( array(","\u0027what\u0027 \u003d\u003e \u0027meta\u0027,","\u0027id\u0027 \u003d\u003e $mid,","\u0027data\u0027 \u003d\u003e _list_meta_row( $meta, $c ),","\u0027position\u0027 \u003d\u003e 1,","\u0027supplemental\u0027 \u003d\u003e array(\u0027postid\u0027 \u003d\u003e $pid)",") );","} else { // Update?","$mid \u003d (int) key( $_POST[\u0027meta\u0027] );","$key \u003d stripslashes( $_POST[\u0027meta\u0027][$mid][\u0027key\u0027] );","$value \u003d stripslashes( $_POST[\u0027meta\u0027][$mid][\u0027value\u0027] );","if ( \u0027\u0027 \u003d\u003d trim($key) )","die(__(\u0027Please provide a custom field name.\u0027));","if ( \u0027\u0027 \u003d\u003d trim($value) )","die(__(\u0027Please provide a custom field value.\u0027));","if ( ! $meta \u003d get_metadata_by_mid( \u0027post\u0027, $mid ) )","die(\u00270\u0027); // if meta doesn\u0027t exist","if ( is_protected_meta( $meta-\u003emeta_key, \u0027post\u0027 ) || is_protected_meta( $key, \u0027post\u0027 ) ||","! current_user_can( \u0027edit_post_meta\u0027, $meta-\u003epost_id, $meta-\u003emeta_key ) ||","! current_user_can( \u0027edit_post_meta\u0027, $meta-\u003epost_id, $key ) )","die(\u0027-1\u0027);","if ( $meta-\u003emeta_value !\u003d $value || $meta-\u003emeta_key !\u003d $key ) {","if ( !$u \u003d update_metadata_by_mid( \u0027post\u0027, $mid, $value, $key ) )","die(\u00270\u0027); // We know meta exists; we also know it\u0027s unchanged (or DB error, in which case there are bigger problems).","}","","$x \u003d new WP_Ajax_Response( array(","\u0027what\u0027 \u003d\u003e \u0027meta\u0027,","\u0027id\u0027 \u003d\u003e $mid, \u0027old_id\u0027 \u003d\u003e $mid,","\u0027data\u0027 \u003d\u003e _list_meta_row( array(","\u0027meta_key\u0027 \u003d\u003e $key,","\u0027meta_value\u0027 \u003d\u003e $value,","\u0027meta_id\u0027 \u003d\u003e $mid","), $c ),","\u0027position\u0027 \u003d\u003e 0,","\u0027supplemental\u0027 \u003d\u003e array(\u0027postid\u0027 \u003d\u003e $meta-\u003epost_id)",") );","}","$x-\u003esend();","break;","case \u0027add-user\u0027 :","check_ajax_referer( $action );","if ( ! current_user_can(\u0027create_users\u0027) )","die(\u0027-1\u0027);","if ( ! $user_id \u003d edit_user() ) {","die(\u00270\u0027);","} elseif ( is_wp_error( $user_id ) ) {","$x \u003d new WP_Ajax_Response( array(","\u0027what\u0027 \u003d\u003e \u0027user\u0027,","\u0027id\u0027 \u003d\u003e $user_id",") );","$x-\u003esend();","}","$user_object \u003d new WP_User( $user_id );","","$wp_list_table \u003d _get_list_table(\u0027WP_Users_List_Table\u0027);","","$x \u003d new WP_Ajax_Response( array(","\u0027what\u0027 \u003d\u003e \u0027user\u0027,","\u0027id\u0027 \u003d\u003e $user_id,","\u0027data\u0027 \u003d\u003e $wp_list_table-\u003esingle_row( $user_object, \u0027\u0027, $user_object-\u003eroles[0] ),","\u0027supplemental\u0027 \u003d\u003e array(","\u0027show-link\u0027 \u003d\u003e sprintf(__( \u0027User %s added\u0027 ), \"user-$user_id\", $user_object-\u003euser_login),","\u0027role\u0027 \u003d\u003e $user_object-\u003eroles[0]",")",") );","$x-\u003esend();","break;","case \u0027autosave\u0027 : // The name of this action is hardcoded in edit_post()","define( \u0027DOING_AUTOSAVE\u0027, true );","","$nonce_age \u003d check_ajax_referer( \u0027autosave\u0027, \u0027autosavenonce\u0027 );","","$_POST[\u0027post_category\u0027] \u003d explode(\",\", $_POST[\u0027catslist\u0027]);","if ( $_POST[\u0027post_type\u0027] \u003d\u003d \u0027page\u0027 || empty($_POST[\u0027post_category\u0027]) )","unset($_POST[\u0027post_category\u0027]);","","$do_autosave \u003d (bool) $_POST[\u0027autosave\u0027];","$do_lock \u003d true;","","$data \u003d $alert \u003d \u0027\u0027;","/* translators: draft saved date format, see http://php.net/date */","$draft_saved_date_format \u003d __(\u0027g:i:s a\u0027);","/* translators: %s: date and time */","$message \u003d sprintf( __(\u0027Draft saved at %s.\u0027), date_i18n( $draft_saved_date_format ) );","","$supplemental \u003d array();","if ( isset($login_grace_period) )","$alert .\u003d sprintf( __(\u0027Your login has expired. Please open a new browser window and log in again. \u0027), add_query_arg( \u0027interim-login\u0027, 1, wp_login_url() ) );","","$id \u003d $revision_id \u003d 0;","","$post_ID \u003d (int) $_POST[\u0027post_ID\u0027];","$_POST[\u0027ID\u0027] \u003d $post_ID;","$post \u003d get_post($post_ID);","if ( \u0027auto-draft\u0027 \u003d\u003d $post-\u003epost_status )","$_POST[\u0027post_status\u0027] \u003d \u0027draft\u0027;","","if ( $last \u003d wp_check_post_lock( $post-\u003eID ) ) {","$do_autosave \u003d $do_lock \u003d false;","","$last_user \u003d get_userdata( $last );","$last_user_name \u003d $last_user ? $last_user-\u003edisplay_name : __( \u0027Someone\u0027 );","$data \u003d __( \u0027Autosave disabled.\u0027 );","","$supplemental[\u0027disable_autosave\u0027] \u003d \u0027disable\u0027;","$alert .\u003d sprintf( __( \u0027%s is currently editing this article. If you update it, you will overwrite the changes.\u0027 ), esc_html( $last_user_name ) );","}","","if ( \u0027page\u0027 \u003d\u003d $post-\u003epost_type ) {","if ( !current_user_can(\u0027edit_page\u0027, $post_ID) )","die(__(\u0027You are not allowed to edit this page.\u0027));","} else {","if ( !current_user_can(\u0027edit_post\u0027, $post_ID) )","die(__(\u0027You are not allowed to edit this post.\u0027));","}","","if ( $do_autosave ) {","// Drafts and auto-drafts are just overwritten by autosave","if ( \u0027auto-draft\u0027 \u003d\u003d $post-\u003epost_status || \u0027draft\u0027 \u003d\u003d $post-\u003epost_status ) {","$id \u003d edit_post();","} else { // Non drafts are not overwritten. The autosave is stored in a special post revision.","$revision_id \u003d wp_create_post_autosave( $post-\u003eID );","if ( is_wp_error($revision_id) )","$id \u003d $revision_id;","else","$id \u003d $post-\u003eID;","}","$data \u003d $message;","} else {","if ( ! empty( $_POST[\u0027auto_draft\u0027] ) )","$id \u003d 0; // This tells us it didn\u0027t actually save","else","$id \u003d $post-\u003eID;","}","","if ( $do_lock \u0026\u0026 empty( $_POST[\u0027auto_draft\u0027] ) \u0026\u0026 $id \u0026\u0026 is_numeric( $id ) ) {","$lock_result \u003d wp_set_post_lock( $id );","$supplemental[\u0027active-post-lock\u0027] \u003d implode( \u0027:\u0027, $lock_result );","}","","if ( $nonce_age \u003d\u003d 2 ) {","$supplemental[\u0027replace-autosavenonce\u0027] \u003d wp_create_nonce(\u0027autosave\u0027);","$supplemental[\u0027replace-getpermalinknonce\u0027] \u003d wp_create_nonce(\u0027getpermalink\u0027);","$supplemental[\u0027replace-samplepermalinknonce\u0027] \u003d wp_create_nonce(\u0027samplepermalink\u0027);","$supplemental[\u0027replace-closedpostboxesnonce\u0027] \u003d wp_create_nonce(\u0027closedpostboxes\u0027);","$supplemental[\u0027replace-_ajax_linking_nonce\u0027] \u003d wp_create_nonce( \u0027internal-linking\u0027 );","if ( $id ) {","if ( $_POST[\u0027post_type\u0027] \u003d\u003d \u0027post\u0027 )","$supplemental[\u0027replace-_wpnonce\u0027] \u003d wp_create_nonce(\u0027update-post_\u0027 . $id);","elseif ( $_POST[\u0027post_type\u0027] \u003d\u003d \u0027page\u0027 )","$supplemental[\u0027replace-_wpnonce\u0027] \u003d wp_create_nonce(\u0027update-page_\u0027 . $id);","}","}","","if ( ! empty($alert) )","$supplemental[\u0027alert\u0027] \u003d $alert;","","$x \u003d new WP_Ajax_Response( array(","\u0027what\u0027 \u003d\u003e \u0027autosave\u0027,","\u0027id\u0027 \u003d\u003e $id,","\u0027data\u0027 \u003d\u003e $id ? $data : \u0027\u0027,","\u0027supplemental\u0027 \u003d\u003e $supplemental",") );","$x-\u003esend();","break;","case \u0027closed-postboxes\u0027 :","check_ajax_referer( \u0027closedpostboxes\u0027, \u0027closedpostboxesnonce\u0027 );","$closed \u003d isset( $_POST[\u0027closed\u0027] ) ? explode( \u0027,\u0027, $_POST[\u0027closed\u0027]) : array();","$closed \u003d array_filter($closed);","","$hidden \u003d isset( $_POST[\u0027hidden\u0027] ) ? explode( \u0027,\u0027, $_POST[\u0027hidden\u0027]) : array();","$hidden \u003d array_filter($hidden);","","$page \u003d isset( $_POST[\u0027page\u0027] ) ? $_POST[\u0027page\u0027] : \u0027\u0027;","","if ( $page !\u003d sanitize_key( $page ) )","die(\u00270\u0027);","","if ( ! $user \u003d wp_get_current_user() )","die(\u0027-1\u0027);","","if ( is_array($closed) )","update_user_option($user-\u003eID, \"closedpostboxes_$page\", $closed, true);","","if ( is_array($hidden) ) {","$hidden \u003d array_diff( $hidden, array(\u0027submitdiv\u0027, \u0027linksubmitdiv\u0027, \u0027manage-menu\u0027, \u0027create-menu\u0027) ); // postboxes that are always shown","update_user_option($user-\u003eID, \"metaboxhidden_$page\", $hidden, true);","}","","die(\u00271\u0027);","break;","case \u0027hidden-columns\u0027 :","check_ajax_referer( \u0027screen-options-nonce\u0027, \u0027screenoptionnonce\u0027 );","$hidden \u003d isset( $_POST[\u0027hidden\u0027] ) ? $_POST[\u0027hidden\u0027] : \u0027\u0027;","$hidden \u003d explode( \u0027,\u0027, $_POST[\u0027hidden\u0027] );","$page \u003d isset( $_POST[\u0027page\u0027] ) ? $_POST[\u0027page\u0027] : \u0027\u0027;","","if ( $page !\u003d sanitize_key( $page ) )","die(\u00270\u0027);","","if ( ! $user \u003d wp_get_current_user() )","die(\u0027-1\u0027);","","if ( is_array($hidden) )","update_user_option($user-\u003eID, \"manage{$page}columnshidden\", $hidden, true);","","die(\u00271\u0027);","break;","case \u0027update-welcome-panel\u0027 :","check_ajax_referer( \u0027welcome-panel-nonce\u0027, \u0027welcomepanelnonce\u0027 );","","if ( ! current_user_can( \u0027edit_theme_options\u0027 ) )","die(\u0027-1\u0027);","","update_user_meta( get_current_user_id(), \u0027show_welcome_panel\u0027, empty( $_POST[\u0027visible\u0027] ) ? 0 : 1 );","","die(\u00271\u0027);","break;","case \u0027menu-get-metabox\u0027 :","if ( ! current_user_can( \u0027edit_theme_options\u0027 ) )","die(\u0027-1\u0027);","","require_once ABSPATH . \u0027wp-admin/includes/nav-menu.php\u0027;","","if ( isset( $_POST[\u0027item-type\u0027] ) \u0026\u0026 \u0027post_type\u0027 \u003d\u003d $_POST[\u0027item-type\u0027] ) {","$type \u003d \u0027posttype\u0027;","$callback \u003d \u0027wp_nav_menu_item_post_type_meta_box\u0027;","$items \u003d (array) get_post_types( array( \u0027show_in_nav_menus\u0027 \u003d\u003e true ), \u0027object\u0027 );","} elseif ( isset( $_POST[\u0027item-type\u0027] ) \u0026\u0026 \u0027taxonomy\u0027 \u003d\u003d $_POST[\u0027item-type\u0027] ) {","$type \u003d \u0027taxonomy\u0027;","$callback \u003d \u0027wp_nav_menu_item_taxonomy_meta_box\u0027;","$items \u003d (array) get_taxonomies( array( \u0027show_ui\u0027 \u003d\u003e true ), \u0027object\u0027 );","}","","if ( ! empty( $_POST[\u0027item-object\u0027] ) \u0026\u0026 isset( $items[$_POST[\u0027item-object\u0027]] ) ) {","$item \u003d apply_filters( \u0027nav_menu_meta_box_object\u0027, $items[ $_POST[\u0027item-object\u0027] ] );","ob_start();","call_user_func_array($callback, array(","null,","array(","\u0027id\u0027 \u003d\u003e \u0027add-\u0027 . $item-\u003ename,","\u0027title\u0027 \u003d\u003e $item-\u003elabels-\u003ename,","\u0027callback\u0027 \u003d\u003e $callback,","\u0027args\u0027 \u003d\u003e $item,",")","));","","$markup \u003d ob_get_clean();","","echo json_encode(array(","\u0027replace-id\u0027 \u003d\u003e $type . \u0027-\u0027 . $item-\u003ename,","\u0027markup\u0027 \u003d\u003e $markup,","));","}","","exit;","break;","case \u0027menu-quick-search\u0027:","if ( ! current_user_can( \u0027edit_theme_options\u0027 ) )","die(\u0027-1\u0027);","","require_once ABSPATH . \u0027wp-admin/includes/nav-menu.php\u0027;","","_wp_ajax_menu_quick_search( $_REQUEST );","","exit;","break;","case \u0027wp-link-ajax\u0027:","check_ajax_referer( \u0027internal-linking\u0027, \u0027_ajax_linking_nonce\u0027 );","","$args \u003d array();","","if ( isset( $_POST[\u0027search\u0027] ) )","$args[\u0027s\u0027] \u003d stripslashes( $_POST[\u0027search\u0027] );","$args[\u0027pagenum\u0027] \u003d ! empty( $_POST[\u0027page\u0027] ) ? absint( $_POST[\u0027page\u0027] ) : 1;","","require(ABSPATH . WPINC . \u0027/class-wp-editor.php\u0027);","$results \u003d _WP_Editors::wp_link_query( $args );","","if ( ! isset( $results ) )","die( \u00270\u0027 );","","echo json_encode( $results );","echo \"\\n\";","","exit;","break;","case \u0027menu-locations-save\u0027:","if ( ! current_user_can( \u0027edit_theme_options\u0027 ) )","die(\u0027-1\u0027);","check_ajax_referer( \u0027add-menu_item\u0027, \u0027menu-settings-column-nonce\u0027 );","if ( ! isset( $_POST[\u0027menu-locations\u0027] ) )","die(\u00270\u0027);","set_theme_mod( \u0027nav_menu_locations\u0027, array_map( \u0027absint\u0027, $_POST[\u0027menu-locations\u0027] ) );","die(\u00271\u0027);","break;","case \u0027meta-box-order\u0027:","check_ajax_referer( \u0027meta-box-order\u0027 );","$order \u003d isset( $_POST[\u0027order\u0027] ) ? (array) $_POST[\u0027order\u0027] : false;","$page_columns \u003d isset( $_POST[\u0027page_columns\u0027] ) ? $_POST[\u0027page_columns\u0027] : \u0027auto\u0027;","","if ( $page_columns !\u003d \u0027auto\u0027 )","$page_columns \u003d (int) $page_columns;","","$page \u003d isset( $_POST[\u0027page\u0027] ) ? $_POST[\u0027page\u0027] : \u0027\u0027;","","if ( $page !\u003d sanitize_key( $page ) )","die(\u00270\u0027);","","if ( ! $user \u003d wp_get_current_user() )","die(\u0027-1\u0027);","","if ( $order )","update_user_option($user-\u003eID, \"meta-box-order_$page\", $order, true);","","if ( $page_columns )","update_user_option($user-\u003eID, \"screen_layout_$page\", $page_columns, true);","","die(\u00271\u0027);","break;","case \u0027get-permalink\u0027:","check_ajax_referer( \u0027getpermalink\u0027, \u0027getpermalinknonce\u0027 );","$post_id \u003d isset($_POST[\u0027post_id\u0027])? intval($_POST[\u0027post_id\u0027]) : 0;","die(add_query_arg(array(\u0027preview\u0027 \u003d\u003e \u0027true\u0027), get_permalink($post_id)));","break;","case \u0027sample-permalink\u0027:","check_ajax_referer( \u0027samplepermalink\u0027, \u0027samplepermalinknonce\u0027 );","$post_id \u003d isset($_POST[\u0027post_id\u0027])? intval($_POST[\u0027post_id\u0027]) : 0;","$title \u003d isset($_POST[\u0027new_title\u0027])? $_POST[\u0027new_title\u0027] : \u0027\u0027;","$slug \u003d isset($_POST[\u0027new_slug\u0027])? $_POST[\u0027new_slug\u0027] : null;","die(get_sample_permalink_html($post_id, $title, $slug));","break;","case \u0027inline-save\u0027:","check_ajax_referer( \u0027inlineeditnonce\u0027, \u0027_inline_edit\u0027 );","","if ( ! isset($_POST[\u0027post_ID\u0027]) || ! ( $post_ID \u003d (int) $_POST[\u0027post_ID\u0027] ) )","exit;","","if ( \u0027page\u0027 \u003d\u003d $_POST[\u0027post_type\u0027] ) {","if ( ! current_user_can( \u0027edit_page\u0027, $post_ID ) )","die( __(\u0027You are not allowed to edit this page.\u0027) );","} else {","if ( ! current_user_can( \u0027edit_post\u0027, $post_ID ) )","die( __(\u0027You are not allowed to edit this post.\u0027) );","}","","set_current_screen( $_POST[\u0027screen\u0027] );","","if ( $last \u003d wp_check_post_lock( $post_ID ) ) {","$last_user \u003d get_userdata( $last );","$last_user_name \u003d $last_user ? $last_user-\u003edisplay_name : __( \u0027Someone\u0027 );","printf( $_POST[\u0027post_type\u0027] \u003d\u003d \u0027page\u0027 ? __( \u0027Saving is disabled: %s is currently editing this page.\u0027 ) : __( \u0027Saving is disabled: %s is currently editing this post.\u0027 ), esc_html( $last_user_name ) );","exit;","}","","$data \u003d \u0026$_POST;","","$post \u003d get_post( $post_ID, ARRAY_A );","$post \u003d add_magic_quotes($post); //since it is from db","","$data[\u0027content\u0027] \u003d $post[\u0027post_content\u0027];","$data[\u0027excerpt\u0027] \u003d $post[\u0027post_excerpt\u0027];","","// rename","$data[\u0027user_ID\u0027] \u003d $GLOBALS[\u0027user_ID\u0027];","","if ( isset($data[\u0027post_parent\u0027]) )","$data[\u0027parent_id\u0027] \u003d $data[\u0027post_parent\u0027];","","// status","if ( isset($data[\u0027keep_private\u0027]) \u0026\u0026 \u0027private\u0027 \u003d\u003d $data[\u0027keep_private\u0027] )","$data[\u0027post_status\u0027] \u003d \u0027private\u0027;","else","$data[\u0027post_status\u0027] \u003d $data[\u0027_status\u0027];","","if ( empty($data[\u0027comment_status\u0027]) )","$data[\u0027comment_status\u0027] \u003d \u0027closed\u0027;","if ( empty($data[\u0027ping_status\u0027]) )","$data[\u0027ping_status\u0027] \u003d \u0027closed\u0027;","","// update the post","edit_post();","","$wp_list_table \u003d _get_list_table(\u0027WP_Posts_List_Table\u0027);","","$mode \u003d $_POST[\u0027post_view\u0027];","$wp_list_table-\u003edisplay_rows( array( get_post( $_POST[\u0027post_ID\u0027] ) ) );","","exit;","break;","case \u0027inline-save-tax\u0027:","check_ajax_referer( \u0027taxinlineeditnonce\u0027, \u0027_inline_edit\u0027 );","","$taxonomy \u003d sanitize_key( $_POST[\u0027taxonomy\u0027] );","$tax \u003d get_taxonomy( $taxonomy );","if ( ! $tax )","die( \u00270\u0027 );","","if ( ! current_user_can( $tax-\u003ecap-\u003eedit_terms ) )","die( \u0027-1\u0027 );","","set_current_screen( \u0027edit-\u0027 . $taxonomy );","","$wp_list_table \u003d _get_list_table(\u0027WP_Terms_List_Table\u0027);","","if ( ! isset($_POST[\u0027tax_ID\u0027]) || ! ( $id \u003d (int) $_POST[\u0027tax_ID\u0027] ) )","die(-1);","","$tag \u003d get_term( $id, $taxonomy );","$_POST[\u0027description\u0027] \u003d $tag-\u003edescription;","","$updated \u003d wp_update_term($id, $taxonomy, $_POST);","if ( $updated \u0026\u0026 !is_wp_error($updated) ) {","$tag \u003d get_term( $updated[\u0027term_id\u0027], $taxonomy );","if ( !$tag || is_wp_error( $tag ) ) {","if ( is_wp_error($tag) \u0026\u0026 $tag-\u003eget_error_message() )","die( $tag-\u003eget_error_message() );","die( __(\u0027Item not updated.\u0027) );","}","","echo $wp_list_table-\u003esingle_row( $tag );","} else {","if ( is_wp_error($updated) \u0026\u0026 $updated-\u003eget_error_message() )","die( $updated-\u003eget_error_message() );","die( __(\u0027Item not updated.\u0027) );","}","","exit;","break;","case \u0027find_posts\u0027:","check_ajax_referer( \u0027find-posts\u0027 );","","if ( empty($_POST[\u0027ps\u0027]) )","exit;","","if ( !empty($_POST[\u0027post_type\u0027]) \u0026\u0026 in_array( $_POST[\u0027post_type\u0027], get_post_types() ) )","$what \u003d $_POST[\u0027post_type\u0027];","else","$what \u003d \u0027post\u0027;","","$s \u003d stripslashes($_POST[\u0027ps\u0027]);","preg_match_all(\u0027/\".*?(\"|$)|((?\u003c\u003d[\\\\s\",+])|^)[^\\\\s\",+]+/\u0027, $s, $matches);","$search_terms \u003d array_map(\u0027_search_terms_tidy\u0027, $matches[0]);","","$searchand \u003d $search \u003d \u0027\u0027;","foreach ( (array) $search_terms as $term ) {","$term \u003d esc_sql( like_escape( $term ) );","$search .\u003d \"{$searchand}(($wpdb-\u003eposts.post_title LIKE \u0027%{$term}%\u0027) OR ($wpdb-\u003eposts.post_content LIKE \u0027%{$term}%\u0027))\";","$searchand \u003d \u0027 AND \u0027;","}","$term \u003d esc_sql( like_escape( $s ) );","if ( count($search_terms) \u003e 1 \u0026\u0026 $search_terms[0] !\u003d $s )","$search .\u003d \" OR ($wpdb-\u003eposts.post_title LIKE \u0027%{$term}%\u0027) OR ($wpdb-\u003eposts.post_content LIKE \u0027%{$term}%\u0027)\";","","$posts \u003d $wpdb-\u003eget_results( \"SELECT ID, post_title, post_status, post_date FROM $wpdb-\u003eposts WHERE post_type \u003d \u0027$what\u0027 AND post_status IN (\u0027draft\u0027, \u0027publish\u0027) AND ($search) ORDER BY post_date_gmt DESC LIMIT 50\" );","","if ( ! $posts ) {","$posttype \u003d get_post_type_object($what);","exit($posttype-\u003elabels-\u003enot_found);","}","","$html \u003d \u0027\u0027.__(\u0027Title\u0027).\u0027\u0027.__(\u0027Date\u0027).\u0027\u0027.__(\u0027Status\u0027).\u0027\u0027;","foreach ( $posts as $post ) {","","switch ( $post-\u003epost_status ) {","case \u0027publish\u0027 :","case \u0027private\u0027 :","$stat \u003d __(\u0027Published\u0027);","break;","case \u0027future\u0027 :","$stat \u003d __(\u0027Scheduled\u0027);","break;","case \u0027pending\u0027 :","$stat \u003d __(\u0027Pending Review\u0027);","break;","case \u0027draft\u0027 :","$stat \u003d __(\u0027Draft\u0027);","break;","}","","if ( \u00270000-00-00 00:00:00\u0027 \u003d\u003d $post-\u003epost_date ) {","$time \u003d \u0027\u0027;","} else {","/* translators: date format in table columns, see http://php.net/date */","$time \u003d mysql2date(__(\u0027Y/m/d\u0027), $post-\u003epost_date);","}","","$html .\u003d \u0027\u0027;","$html .\u003d \u0027\u0027.esc_html( $post-\u003epost_title ).\u0027\u0027.esc_html( $time ).\u0027\u0027.esc_html( $stat ).\u0027\u0027.\"\\n\\n\";","}","$html .\u003d \u0027\u0027;","","$x \u003d new WP_Ajax_Response();","$x-\u003eadd( array(","\u0027what\u0027 \u003d\u003e $what,","\u0027data\u0027 \u003d\u003e $html","));","$x-\u003esend();","","break;","case \u0027widgets-order\u0027 :","check_ajax_referer( \u0027save-sidebar-widgets\u0027, \u0027savewidgets\u0027 );","","if ( !current_user_can(\u0027edit_theme_options\u0027) )","die(\u0027-1\u0027);","","unset( $_POST[\u0027savewidgets\u0027], $_POST[\u0027action\u0027] );","","// save widgets order for all sidebars","if ( is_array($_POST[\u0027sidebars\u0027]) ) {","$sidebars \u003d array();","foreach ( $_POST[\u0027sidebars\u0027] as $key \u003d\u003e $val ) {","$sb \u003d array();","if ( !empty($val) ) {","$val \u003d explode(\u0027,\u0027, $val);","foreach ( $val as $k \u003d\u003e $v ) {","if ( strpos($v, \u0027widget-\u0027) \u003d\u003d\u003d false )","continue;","","$sb[$k] \u003d substr($v, strpos($v, \u0027_\u0027) + 1);","}","}","$sidebars[$key] \u003d $sb;","}","wp_set_sidebars_widgets($sidebars);","die(\u00271\u0027);","}","","die(\u0027-1\u0027);","break;","case \u0027save-widget\u0027 :","check_ajax_referer( \u0027save-sidebar-widgets\u0027, \u0027savewidgets\u0027 );","","if ( !current_user_can(\u0027edit_theme_options\u0027) || !isset($_POST[\u0027id_base\u0027]) )","die(\u0027-1\u0027);","","unset( $_POST[\u0027savewidgets\u0027], $_POST[\u0027action\u0027] );","","do_action(\u0027load-widgets.php\u0027);","do_action(\u0027widgets.php\u0027);","do_action(\u0027sidebar_admin_setup\u0027);","","$id_base \u003d $_POST[\u0027id_base\u0027];","$widget_id \u003d $_POST[\u0027widget-id\u0027];","$sidebar_id \u003d $_POST[\u0027sidebar\u0027];","$multi_number \u003d !empty($_POST[\u0027multi_number\u0027]) ? (int) $_POST[\u0027multi_number\u0027] : 0;","$settings \u003d isset($_POST[\u0027widget-\u0027 . $id_base]) \u0026\u0026 is_array($_POST[\u0027widget-\u0027 . $id_base]) ? $_POST[\u0027widget-\u0027 . $id_base] : false;","$error \u003d \u0027\u0027 . __(\u0027An error has occurred. Please reload the page and try again.\u0027) . \u0027\u0027;","","$sidebars \u003d wp_get_sidebars_widgets();","$sidebar \u003d isset($sidebars[$sidebar_id]) ? $sidebars[$sidebar_id] : array();","","// delete","if ( isset($_POST[\u0027delete_widget\u0027]) \u0026\u0026 $_POST[\u0027delete_widget\u0027] ) {","","if ( !isset($wp_registered_widgets[$widget_id]) )","die($error);","","$sidebar \u003d array_diff( $sidebar, array($widget_id) );","$_POST \u003d array(\u0027sidebar\u0027 \u003d\u003e $sidebar_id, \u0027widget-\u0027 . $id_base \u003d\u003e array(), \u0027the-widget-id\u0027 \u003d\u003e $widget_id, \u0027delete_widget\u0027 \u003d\u003e \u00271\u0027);","} elseif ( $settings \u0026\u0026 preg_match( \u0027/__i__|%i%/\u0027, key($settings) ) ) {","if ( !$multi_number )","die($error);","","$_POST[\u0027widget-\u0027 . $id_base] \u003d array( $multi_number \u003d\u003e array_shift($settings) );","$widget_id \u003d $id_base . \u0027-\u0027 . $multi_number;","$sidebar[] \u003d $widget_id;","}","$_POST[\u0027widget-id\u0027] \u003d $sidebar;","","foreach ( (array) $wp_registered_widget_updates as $name \u003d\u003e $control ) {","","if ( $name \u003d\u003d $id_base ) {","if ( !is_callable( $control[\u0027callback\u0027] ) )","continue;","","ob_start();","call_user_func_array( $control[\u0027callback\u0027], $control[\u0027params\u0027] );","ob_end_clean();","break;","}","}","","if ( isset($_POST[\u0027delete_widget\u0027]) \u0026\u0026 $_POST[\u0027delete_widget\u0027] ) {","$sidebars[$sidebar_id] \u003d $sidebar;","wp_set_sidebars_widgets($sidebars);","echo \"deleted:$widget_id\";","die();","}","","if ( !empty($_POST[\u0027add_new\u0027]) )","die();","","if ( $form \u003d $wp_registered_widget_controls[$widget_id] )","call_user_func_array( $form[\u0027callback\u0027], $form[\u0027params\u0027] );","","die();","break;","case \u0027image-editor\u0027:","$attachment_id \u003d intval($_POST[\u0027postid\u0027]);","if ( empty($attachment_id) || !current_user_can(\u0027edit_post\u0027, $attachment_id) )","die(\u0027-1\u0027);","","check_ajax_referer( \"image_editor-$attachment_id\" );","include_once( ABSPATH . \u0027wp-admin/includes/image-edit.php\u0027 );","","$msg \u003d false;","switch ( $_POST[\u0027do\u0027] ) {","case \u0027save\u0027 :","$msg \u003d wp_save_image($attachment_id);","$msg \u003d json_encode($msg);","die($msg);","break;","case \u0027scale\u0027 :","$msg \u003d wp_save_image($attachment_id);","break;","case \u0027restore\u0027 :","$msg \u003d wp_restore_image($attachment_id);","break;","}","","wp_image_editor($attachment_id, $msg);","die();","break;","case \u0027set-post-thumbnail\u0027:","$post_ID \u003d intval( $_POST[\u0027post_id\u0027] );","if ( !current_user_can( \u0027edit_post\u0027, $post_ID ) )","die( \u0027-1\u0027 );","$thumbnail_id \u003d intval( $_POST[\u0027thumbnail_id\u0027] );","","check_ajax_referer( \"set_post_thumbnail-$post_ID\" );","","if ( $thumbnail_id \u003d\u003d \u0027-1\u0027 ) {","if ( delete_post_thumbnail( $post_ID ) )","die( _wp_post_thumbnail_html() );","else","die( \u00270\u0027 );","}","","if ( set_post_thumbnail( $post_ID, $thumbnail_id ) )","die( _wp_post_thumbnail_html( $thumbnail_id ) );","die( \u00270\u0027 );","break;","case \u0027date_format\u0027 :","die( date_i18n( sanitize_option( \u0027date_format\u0027, $_POST[\u0027date\u0027] ) ) );","break;","case \u0027time_format\u0027 :","die( date_i18n( sanitize_option( \u0027time_format\u0027, $_POST[\u0027date\u0027] ) ) );","break;","case \u0027wp-fullscreen-save-post\u0027 :","$post_id \u003d isset( $_POST[\u0027post_ID\u0027] ) ? (int) $_POST[\u0027post_ID\u0027] : 0;","","$post \u003d $post_type \u003d null;","","if ( $post_id )","$post \u003d get_post( $post_id );","","if ( $post )","$post_type \u003d $post-\u003epost_type;","elseif ( isset( $_POST[\u0027post_type\u0027] ) \u0026\u0026 post_type_exists( $_POST[\u0027post_type\u0027] ) )","$post_type \u003d $_POST[\u0027post_type\u0027];","","check_ajax_referer(\u0027update-\u0027 . $post_type . \u0027_\u0027 . $post_id, \u0027_wpnonce\u0027);","","$post_id \u003d edit_post();","","if ( is_wp_error($post_id) ) {","if ( $post_id-\u003eget_error_message() )","$message \u003d $post_id-\u003eget_error_message();","else","$message \u003d __(\u0027Save failed\u0027);","","echo json_encode( array( \u0027message\u0027 \u003d\u003e $message, \u0027last_edited\u0027 \u003d\u003e \u0027\u0027 ) );","die();","} else {","$message \u003d __(\u0027Saved.\u0027);","}","","if ( $post ) {","$last_date \u003d mysql2date( get_option(\u0027date_format\u0027), $post-\u003epost_modified );","$last_time \u003d mysql2date( get_option(\u0027time_format\u0027), $post-\u003epost_modified );","} else {","$last_date \u003d date_i18n( get_option(\u0027date_format\u0027) );","$last_time \u003d date_i18n( get_option(\u0027time_format\u0027) );","}","","if ( $last_id \u003d get_post_meta($post_id, \u0027_edit_last\u0027, true) ) {","$last_user \u003d get_userdata($last_id);","$last_edited \u003d sprintf( __(\u0027Last edited by %1$s on %2$s at %3$s\u0027), esc_html( $last_user-\u003edisplay_name ), $last_date, $last_time );","} else {","$last_edited \u003d sprintf( __(\u0027Last edited on %1$s at %2$s\u0027), $last_date, $last_time );","}","","echo json_encode( array( \u0027message\u0027 \u003d\u003e $message, \u0027last_edited\u0027 \u003d\u003e $last_edited ) );","die();","break;","case \u0027wp-remove-post-lock\u0027 :","if ( empty( $_POST[\u0027post_ID\u0027] ) || empty( $_POST[\u0027active_post_lock\u0027] ) )","die( \u00270\u0027 );","$post_id \u003d (int) $_POST[\u0027post_ID\u0027];","if ( ! $post \u003d get_post( $post_id ) )","die( \u00270\u0027 );","","check_ajax_referer( \u0027update-\u0027 . $post-\u003epost_type . \u0027_\u0027 . $post_id );","","if ( ! current_user_can( \u0027edit_post\u0027, $post_id ) )","die( \u0027-1\u0027 );","","$active_lock \u003d array_map( \u0027absint\u0027, explode( \u0027:\u0027, $_POST[\u0027active_post_lock\u0027] ) );","if ( $active_lock[1] !\u003d get_current_user_id() )","die( \u00270\u0027 );","","$new_lock \u003d ( time() - apply_filters( \u0027wp_check_post_lock_window\u0027, AUTOSAVE_INTERVAL * 2 ) + 5 ) . \u0027:\u0027 . $active_lock[1];","update_post_meta( $post_id, \u0027_edit_lock\u0027, $new_lock, implode( \u0027:\u0027, $active_lock ) );","die( \u00271\u0027 );","case \u0027dismiss-wp-pointer\u0027 :","$pointer \u003d $_POST[\u0027pointer\u0027];","if ( $pointer !\u003d sanitize_key( $pointer ) )","die( \u00270\u0027 );","","// check_ajax_referer( \u0027dismiss-pointer_\u0027 . $pointer );","","$dismissed \u003d array_filter( explode( \u0027,\u0027, (string) get_user_meta( get_current_user_id(), \u0027dismissed_wp_pointers\u0027, true ) ) );","","if ( in_array( $pointer, $dismissed ) )","die( \u00270\u0027 );","","$dismissed[] \u003d $pointer;","$dismissed \u003d implode( \u0027,\u0027, $dismissed );","","update_user_meta( get_current_user_id(), \u0027dismissed_wp_pointers\u0027, $dismissed );","die( \u00271\u0027 );","break;","default :","do_action( \u0027wp_ajax_\u0027 . $_POST[\u0027action\u0027] );","die(\u00270\u0027);","break;","endswitch;","// Default status","die(\u0027-1\u0027);","No newline at end of file"]],"pageTitle":"15327.4.diff on Ticket #15327 – Attachment – WordPress Trac","title":"","url":"https://core.trac.wordpress.org/attachment/ticket/15327/15327.4.diff","hasHeader":true,"headerPosition":"FIRST_COLUMN","tableType":"RELATION","tableNum":1,"s3Link":"common-crawl/crawl-data/CC-MAIN-2015-32/segments/1438042988310.3/warc/CC-MAIN-20150728002308-00009-ip-10-236-191-2.ec2.internal.warc.gz","recordEndOffset":850997883,"recordOffset":850950294,"tableOrientation":"VERTICAL","textBeforeTable":"wp-admin/admin-ajax.php File 15327.4.diff, 68.5 KB (added by nacin, 4 years ago) Ticket #15327: 15327.4.diff Back to Ticket #15327 Context Navigation Notifications Login Search: Create a New Ticket Trac Timeline Browse Source Components Tickets Handbook Blog Make WordPress Core Download WordPress Hosting Blog About Get Involved Documentation Forums Support Mobile","textAfterTable":"wp-admin/includes/ajax-actions.php   1 1 \u003c?php  2 2 /**  3    * WordPress AJAX Process Execution.    3  * WordPress Core Ajax Handlers.  4 4  *  5 5  * @package WordPress  6 6  * @subpackage Administration  7 7  */  8 8   9   /**  10    * Executing AJAX process.  11    *  12    * @since 2.1.0    9 /*    10  * No-privilege Ajax handlers.  13 11  */  14   define(\u0027DOING_AJAX\u0027, true);  15   define(\u0027WP_ADMIN\u0027, true);  16 12   17   if ( ! isset( $_REQUEST[\u0027action\u0027] ) )  18           die(\u0027-1\u0027);    13 function wp_ajax_nopriv_autosave() {    14         $id \u003d isset( $_POST[\u0027post_ID\u0027] )","hasKeyColumn":true,"keyColumnIndex":6,"headerRowIndex":0}